description: "Daily Run"
schedule_interval: "0 0 1 */12 *"
tags:
  - version_1
default_args:
  start_date: 2021-01
catchup: false
nodes:
  extract_and_load_airbyte:
    generator: AirbyteDbtGenerator
    airbyte_conn_id: airbyte_connection

    type: task_group
    tooltip: "Airbyte Extract and Load"
    dbt_list_args: "--select tag:daily_run_airbyte"

  extract_and_load_fivetran:
    generator: FivetranDbtGenerator
    fivetran_conn_id: fivetran_connection

    type: task_group
    tooltip: "Fivetran Extract and Load"
    dbt_list_args: "--select tag:daily_run_fivetran"

  transform:
    operator: airflow.operators.bash.BashOperator
    type: task

    bash_command: "$DATACOVES__REPO_PATH/automate/blue_green_run.py -s 'tag:daily_run_airbyte+ tag:daily_run_fivetran+ -t prd'"
    dependencies: ["extract_and_load_airbyte","extract_and_load_fivetran"]

  marketing_automation:
    operator: airflow.operators.bash.BashOperator
    type: task

    bash_command: "echo 'send data to marketing tool'"
    dependencies: ["transform"]

  update_catalog:
    operator: airflow.operators.bash.BashOperator
    type: task

    bash_command: "echo 'refresh data catalog'"
    dependencies: ["transform"]
